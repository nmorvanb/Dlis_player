<!DOCTYPE html>
<html>
    <style>
        .player{
            position: fixed;
            bottom: 0px;
            width: 100%;
        }
        button{
            padding: 15px 32px;
            font-size: 16px;
        }
    </style>
    <head>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    </head>
    <body>
        <div class="player">
            <audio id="audioElt" src="ressources/audio/ewen%20-%20One%20forgiven%20(original).mp3"  ontimeupdate="initProgressBar()" onvolumechange="changeBtnSound()"></audio>
            <button class="fa fa-volume-up" id="btnSound"></button>
            <input id="volumeslider" type="range" min="0" max="100" value="100" step="1">
            <div id="fileAttente">Contenu de la playlist
                <ul>
                    <li> 1 - Première chanson - Auteur 1 - 03:53 - 01/01/2019 </li>
                    <li> 2 - Deuxième chanson - Auteur 2 - 02:35 - 25/06/2007 </li>
                </ul>
            </div>
            <div class="boutons">
                <button class="fa fa-backward" id="btnPrev"></button>
                <button class="fa fa-play" title="Play current" id="btnPlay"></button>
                <button class="fa fa-pause" title="Pause current" id="btnPause"></button>
                <button class="fa fa-forward" id="btnNext"></button>
                <button class="fa fa-random" title="Shuffle" id="btnRandom"></button>
                <button class="fa fa-redo" title="Repeat" id="btnLoop"></button>
                <small id="start-time"></small>
                <progress id="seekObj" value="0" max="1"></progress>
                <small id="end-time"></small>
                <button class="fa fa-list" title="Playlist" id="btnFileAttente"></button>
                <button class="far fa-heart" title="Like" id="btnLike"></button>
            </div>
        </div>
    </body>
    <script src="lpdlis/Playlist.js"></script>
    <script src="lpdlis/Player.js"></script>
    <script>
        //Récupérer les boutons
        var btnPrev = document.getElementById("btnPrev");
        var btnPlay = document.getElementById("btnPlay");
        var btnPause = document.getElementById("btnPause");
        var btnNext = document.getElementById("btnNext");
        var btnRandom = document.getElementById("btnRandom");
        var btnLoop = document.getElementById("btnLoop");
        var btnFileAttente = document.getElementById("btnFileAttente");
        var btnLike = document.getElementById("btnLike");

        //Récupérer les éléments du player
        var fileAttente = document.getElementById("fileAttente");
        var audioElt = document.getElementById("audioElt");
        var volumeslider = document.getElementById("volumeslider");

        //Créer le player
        var player = new Player(audioElt,0,0,fileAttente);

        //temporaire bouton pause invisible
        btnPause.style.display = "none";

        //Assigner des évènements aux boutons
        btnPrev.addEventListener("click", function(){
            player.playPrev();
        });

        btnPlay.addEventListener("click", function(){
            player.play();
            btnPlay.style.display = "none";
            btnPause.style.display = "inline";
        });

        btnPause.addEventListener("click", function(){
            player.pause();
            btnPause.style.display = "none";
            btnPlay.style.display = "inline";
        });

        btnNext.addEventListener("click", function(){
            player.playNext();
        });

        btnRandom.addEventListener("click", function(){
            if(player.playlist.getRandom()){
                player.playlist.setRandom(false);
            }
            else{
                player.playlist.setRandom(true);
            }
        });

        btnLoop.addEventListener("click", function(){
            if(player.playlist.getLoop()){
                player.playlist.setLoop(false);
            }
            else{
                player.playlist.setLoop(true);
            }
        });

        btnFileAttente.addEventListener("click", function(){
            if(getComputedStyle(fileAttente).display != "none"){
                player.hidePlaylist();
            } else {
                player.showPlaylist();
            }
        });

        btnLike.addEventListener("click", function(){
            btnLike.classList.toggle('far');
            btnLike.classList.toggle('fa');
        });

        //Calcule la durée totale en minutes:secondes
        function calculateTotalValue(length) {
            var minutes = Math.floor(length / 60),
                seconds_int = length - minutes * 60,
                seconds_str = seconds_int.toString(),
                seconds = seconds_str.substr(0, 2),
                time = minutes + ':' + seconds

            return time;
        }

        //Calcule la durée actuelle en minutes:secondes
        function calculateCurrentValue(currentTime) {
            var current_hour = parseInt(currentTime / 3600) % 24,
                current_minute = parseInt(currentTime / 60) % 60,
                current_seconds_long = currentTime % 60,
                current_seconds = current_seconds_long.toFixed(),
                current_time = (current_minute < 10 ? "0" + current_minute : current_minute) + ":" + (current_seconds < 10 ? "0" + current_seconds : current_seconds);

            return current_time;
        }

        //Met à jour la barre de progression ainsi que la valeur d'avancement, permet aussi de cliquer sur la barre
        function initProgressBar() {
            var length = audioElt.duration;
            var current_time = audioElt.currentTime;

            var progressbar = document.getElementById('seekObj');
            progressbar.value = (audioElt.currentTime / audioElt.duration);
            progressbar.addEventListener("click", seek);

            document.getElementById("end-time").innerHTML = calculateTotalValue(length);
            document.getElementById("start-time").innerHTML = calculateCurrentValue(current_time);

            function seek(evt) {
                var percent = evt.offsetX / this.offsetWidth;
                audioElt.currentTime = percent * audioElt.duration;
                progressbar.value = percent / 100;
            }
        };

        volumeslider.addEventListener("mousemove", function(){
            audioElt.volume = volumeslider.value / 100;
        });

        function changeBtnSound(){
            if(audioElt.volume == 0){
                btnSound.classList.replace('fa-volume-up','fa-volume-off');
            }
            else{
                btnSound.classList.replace('fa-volume-off','fa-volume-up');
            }
        }

    </script>

</html>